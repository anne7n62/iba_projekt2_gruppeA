<!DOCTYPE html>
<html lang="da">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mit Vejr</title>
    <style>
      select:disabled {
        background-color: #eee;
        color: #666;
      }
    </style>
  </head>
  <body>
    <h1>Velkommen</h1>
    <p>
      Vælg dit køn og lokation (eller brug geolokation). Derefter får du
      temperatur, vejrtype og tøjforslag.
    </p>

    <form id="vejrForm">
      <fieldset>
        <legend>Køn</legend>
        <input type="radio" name="køn" id="selectMand" value="mand" />
        <label for="selectMand">Mand</label>

        <input type="radio" name="køn" id="selectKvinde" value="kvinde" />
        <label for="selectKvinde">Kvinde</label>
      </fieldset>

      <fieldset>
        <legend>Lokation</legend>
      <input type="text" id="selectCity">
        <button type="button" id="geoStatus">Geolokation: forsøger...</button>
      </fieldset>

      <button type="submit">Fortsæt</button>
    </form>

    <!-- remove in final code -->
    <p id="resultat"></p>

    <script>
    const apiKey = "328576f875ac77cda31866cea4f13252";
const geoStatusBtn = document.getElementById("geoStatus");
const form = document.getElementById("weatherForm");
const selectCity = document.getElementById("selectCity");
const suggestionBox = document.createElement("div");
suggestionBox.classList.add("suggestions");
selectCity.parentNode.appendChild(suggestionBox);

let geoEnabled = false;
let currentCoords = null;

// --- GEOLOKATION ---
document.addEventListener("DOMContentLoaded", () => {
  if ("geolocation" in navigator) {
    navigator.geolocation.getCurrentPosition(success, error);
  }
});

function success(position) {
  geoEnabled = true;
  currentCoords = {
    lat: position.coords.latitude,
    lon: position.coords.longitude,
  };
  geoStatusBtn.textContent = "Automatisk lokation: slået til";
  selectCity.disabled = true;
  console.log("Geolokation fundet:", currentCoords);
}

function error() {
  geoEnabled = false;
  currentCoords = null;
  geoStatusBtn.textContent = "Automatisk lokation: slået fra";
  selectCity.disabled = false;
}

// --- AUTOCOMPLETE ---
selectCity.addEventListener("input", async () => {
  const query = selectCity.value.trim();
  if (query.length < 2) {
    suggestionBox.innerHTML = "";
    return;
  }

  const url = `https://api.openweathermap.org/geo/1.0/direct?q=${query}&limit=5&appid=${apiKey}`;
  const response = await fetch(url);
  const cities = await response.json();

  suggestionBox.innerHTML = "";
  cities.forEach(city => {
    const item = document.createElement("div");
    item.classList.add("suggestion-item");
    item.textContent = `${city.name}, ${city.country}`;
    item.addEventListener("click", () => {
      selectCity.value = city.name;
      suggestionBox.innerHTML = "";
      currentCoords = { lat: city.lat, lon: city.lon };
      geoEnabled = false; // manuel valg = slå geo fra
      setWeather(currentCoords);
    });
    suggestionBox.appendChild(item);
  });
});

// --- FORM SUBMIT ---
form.addEventListener("submit", (e) => {
  e.preventDefault();
  if (geoEnabled && currentCoords) {
    setWeather(currentCoords);
  } else if (currentCoords) {
    setWeather(currentCoords);
  } else {
    alert("Vælg en by eller slå geolokation til.");
  }
});

// --- FETCH VEJRET ---
async function setWeather(lokation) {
  const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lokation.lat}&lon=${lokation.lon}&appid=${apiKey}&units=metric&lang=da`;
  try {
    const res = await fetch(url);
    const data = await res.json();
    console.log("VEJRDATA:", data);
    // Du kan fx vise vejret på siden:
    document.getElementById("weatherOutput").textContent =
      `${data.name}: ${data.weather[0].description}, ${data.main.temp}°C`;
  } catch (err) {
    console.error("Fejl ved hentning af vejrdata:", err);
  }
}

    </script>
  </body>
</html>
