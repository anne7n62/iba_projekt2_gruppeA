<!DOCTYPE html>
<html lang="da">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mit Vejr</title>
    <style>
      select:disabled {
        background-color: #eee;
        color: #666;
      }
    </style>
  </head>
  <body>
    <h1>Velkommen</h1>
    <p>
      Vælg dit køn og lokation (eller brug geolokation). Derefter får du
      temperatur, vejrtype og tøjforslag.
    </p>

    <form id="vejrForm">
      <fieldset>
        <legend>Køn</legend>
        <input type="radio" name="køn" id="selectMand" value="mand" />
        <label for="selectMand">Mand</label>

        <input type="radio" name="køn" id="selectKvinde" value="kvinde" />
        <label for="selectKvinde">Kvinde</label>
      </fieldset>

      <fieldset>
        <legend>Lokation</legend>
        <!-- <label for="byDropdown">Vælg by manuelt:</label><br /> -->
        <select id="byDropdown">
          <option value="">-- Vælg en by --</option>
          <option value="København">København</option>
          <option value="Aarhus">Aarhus</option>
          <option value="Odense">Odense</option>
          <option value="Aalborg">Aalborg</option>
          <option value="Esbjerg">Esbjerg</option>
        </select>
        <br /><br />
        <button type="button" id="geoStatus">Geolokation: forsøger...</button>
      </fieldset>

      <button type="submit">Fortsæt</button>
    </form>

    <!-- remove in final code -->
    <p id="resultat"></p>

    <script>
      const geoStatusBtn = document.getElementById("geoStatus");
      const byDropdown = document.getElementById("byDropdown");
      const resultat = document.getElementById("resultat");
      const form = document.getElementById("vejrForm");

      let geoEnabled = false;
      let currentCoords = null;

      // By-koordinater: TO DO: Arbejd videre med denne. Hvordan fungerer det med
      const byerKoordinater = {
        København: { lat: 55.68, lon: 12.57 },
        Aarhus: { lat: 56.16, lon: 10.21 },
        Odense: { lat: 55.4, lon: 10.38 },
        Aalborg: { lat: 57.05, lon: 9.93 },
        Esbjerg: { lat: 55.47, lon: 8.45 },
      };

      // Forsøg geolokation ved side-load
      document.addEventListener("DOMContentLoaded", () => {
        if ("geolocation" in navigator) {
          navigator.geolocation.getCurrentPosition(success, error, {
            enableHighAccuracy: true,
            timeout: 20000,
            maximumAge: 0,
          });
        } else {
          geoStatusBtn.textContent = "Geolokation ikke understøttet";
          byDropdown.disabled = false;
        }
      });

      function success(position) {
        geoEnabled = true;
        currentCoords = {
          lat: position.coords.latitude,
          lon: position.coords.longitude,
        };
        geoStatusBtn.textContent = "Geolokation: slået til";
        byDropdown.disabled = true;
        resultat.textContent = `Din position: ${currentCoords.lat.toFixed(
          2
        )}, ${currentCoords.lon.toFixed(2)}`;
      }

      function error() {
        geoEnabled = false;
        currentCoords = null;
        geoStatusBtn.textContent = "Geolokation: slået fra";
        byDropdown.disabled = false;
        // resultat.textContent = "Vælg by manuelt.";
      }

      // Klik på geolokations-knap for at toggle
      geoStatusBtn.addEventListener("click", () => {
        if (geoEnabled) {
          // slå fra
          geoEnabled = false;
          currentCoords = null;
          geoStatusBtn.textContent = "Geolokation: slået fra";
          byDropdown.disabled = false;
          resultat.textContent = "Vælg by manuelt.";
        } else {
          // forsøger igen
          geoStatusBtn.textContent = "Geolokation: forsøger...";
          navigator.geolocation.getCurrentPosition(success, error, {
            enableHighAccuracy: true,
            timeout: 20000,
            maximumAge: 0,
          });
        }
      });

      // Når form submit
      form.addEventListener("submit", (e) => {
        e.preventDefault();

        // Hent køn
        const køn = form.køn.value;

        // Hent lokation
        let lokation = {};
        if (geoEnabled && currentCoords) {
          lokation = currentCoords;
        } else {
          const byValg = byDropdown.value;
          if (byerKoordinater[byValg]) {
            lokation = byerKoordinater[byValg];
          } else {
            alert("Vælg en by eller slå geolokation til.");
            return;
          }
        }

        // Gem i localStorage - virker dette?
        // localStorage.setItem("køn", køn);
        // localStorage.setItem("lokation", JSON.stringify(lokation));

        // Send til funktioner
        setVejr(køn, lokation);
        setKøn(køn, lokation);

        resultat.textContent =
          "Data gemt og sendt til funktioner. Skifter side når vi trykke på knap";
      });

      // Placeholder-funktioner
      function setVejr(lokation) {
        console.log("funktion1:", køn, lokation);
      }

      function setKøn(køn) {
        console.log("funktion2:", køn, lokation);
      }
    </script>
  </body>
</html>
