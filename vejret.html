<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vejret</title>
    <link rel="stylesheet" href="CSS/style.css">
    <script src="script.js" defer></script>
    <script src="https://kit.fontawesome.com/e9eeb44cb1.js" crossorigin="anonymous"></script>
</head>
<body>
    <div class="mobile-wrapper">
    <div class="mobileApp">
<header>
    <h1>ğŸŒ¤VejrApp</h1>
    <button><a href="index.html">Tilbage</a></button>
 </header>
    <main>
  <p id="dateLabel">â€”</p>
  <h2 id="cityLabel">â€”</h2>
  <div id="tempNow">â€”Â°C</div>
  <div id="tempRange">Min: â€”Â° Â· Max: â€”Â°</div>
  <div id="conditionText">â€”</div>
  <div id="weatherIcon" aria-hidden="true"></div>

  <h3>TÃ¸jforslag</h3>
  <div>
    <button id="genderMale" type="button" aria-pressed="true">Mand</button>
    <button id="genderFemale" type="button" aria-pressed="false">Kvinde</button>
  </div>
  </main>
<div id="loader">Henter vejrâ€¦</div>
<p id="statusMsg"></p>
 </div>
 </div>


    <script>
const apiKey = "328576f875ac77cda31866cea4f13252";

// DOM
const dateLabel = document.getElementById("dateLabel");
const cityLabel = document.getElementById("cityLabel");
const tempNow = document.getElementById("tempNow");
const tempRange = document.getElementById("tempRange");
const conditionText = document.getElementById("conditionText");
const iconBox = document.getElementById("weatherIcon");
const loader = document.getElementById("loader");

const genderMale = document.getElementById("genderMale");
const genderFemale = document.getElementById("genderFemale");

// State
let lastWeather = null;

// Helpers
const round = (n) => Math.round(Number(n));
const formatDate = (d = new Date()) =>
  d.toLocaleDateString("da-DK", {
    weekday: "long",
    day: "2-digit",
    month: "2-digit",
    year: "numeric",
  });

function loadCoords() {
  const raw = localStorage.getItem("weather.coords");
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}

function setLoading(on) {
  loader.hidden = !on;
}

// Ikoner (simplificeret)
const Icons = {
  sun: () => `â˜€ï¸`,
  cloud: () => `â˜ï¸`,
  rain: () => `ğŸŒ§`,
  snow: () => `ğŸŒ¨`,
  storm: () => `ğŸŒª`
};

function inferWeatherType(id, desc = "") {
  if (id >= 200 && id < 300) return "storm";
  if (id >= 600 && id < 700) return "snow";
  if (id >= 500 && id < 600) return "rain";
  if (id === 800) return "sun";
  if (id > 800) return "cloud";
  const t = desc.toLowerCase();
  if (t.includes("regn")) return "rain";
  if (t.includes("sne")) return "snow";
  if (t.includes("torden")) return "storm";
  if (t.includes("sky")) return "cloud";
  return "sun";
}


// Render UI
function render(data) {
  const temp = data.main.temp;
  const min = data.main.temp_min;
  const max = data.main.temp_max;
  const id = data.weather[0].id;
  const desc = data.weather[0].description;
  const type = inferWeatherType(id, desc);
  const gender = localStorage.getItem("weather.gender") || "mand";

  dateLabel.textContent = formatDate();
  cityLabel.textContent = data.name;
  tempNow.textContent = `${round(temp)}Â°C`;
  tempRange.textContent = `Min: ${round(min)}Â° Â· Max: ${round(max)}Â°`;
  conditionText.textContent = desc;
  iconBox.innerHTML = Icons[type]();

  const outfit = getOutfit(gender, temp, type);
  outfitList.innerHTML = outfit.map(i => `<li>${i}</li>`).join("");

  lastWeather = data;
}

// Fetch weather from coords
async function fetchWeather(coords) {
  if (!coords) {
    statusMsg.textContent = "Ingen lokation fundet â€” gÃ¥ tilbage.";
    return;
  }

  setLoading(true);
  try {
    const res = await fetch(
      `https://api.openweathermap.org/data/2.5/weather?lat=${coords.lat}&lon=${coords.lon}&appid=${apiKey}&units=metric&lang=da`
    );
    const data = await res.json();
    render(data);
    statusMsg.textContent = "Vejr opdateret âœ…";
  } catch {
    statusMsg.textContent = "Kunne ikke hente vejr âŒ";
  }
  setLoading(false);
}

// Init
(function () {
  const coords = loadCoords();
  if (!coords) {
    statusMsg.textContent = "Ingen gemt lokation â€” vÃ¦lg pÃ¥ forrige side.";
    return;
  }
  fetchWeather(coords);
})();
</script>

</body>
</html>
